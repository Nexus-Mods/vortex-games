"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.migrate020 = void 0;
const path_1 = __importDefault(require("path"));
const semver_1 = __importDefault(require("semver"));
const vortex_api_1 = require("vortex-api");
const statics_1 = require("./statics");
const util_1 = require("./util");
function migrate020(context, oldVersion) {
    if (semver_1.default.gte(oldVersion, '0.2.0')) {
        return Promise.resolve();
    }
    const discoveryPath = (0, util_1.getDiscoveryPath)(context.api.getState());
    if (discoveryPath === undefined) {
        return Promise.resolve();
    }
    const modsPath = path_1.default.join(discoveryPath, statics_1.DATAPATH, 'VortexMods');
    return context.api.awaitUI()
        .then(() => vortex_api_1.fs.ensureDirWritableAsync(modsPath))
        .then(() => context.api.emitAndAwait('purge-mods-in-path', statics_1.GAME_ID, '', modsPath));
}
exports.migrate020 = migrate020;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlncmF0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1pZ3JhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsZ0RBQXdCO0FBQ3hCLG9EQUE0QjtBQUM1QiwyQ0FBZ0M7QUFFaEMsdUNBQTJEO0FBQzNELGlDQUEwQztBQTBCMUMsU0FBZ0IsVUFBVSxDQUFDLE9BQU8sRUFBRSxVQUFVO0lBQzVDLElBQUksZ0JBQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFO1FBQ25DLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQzFCO0lBRUQsTUFBTSxhQUFhLEdBQUcsSUFBQSx1QkFBZ0IsRUFBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDL0QsSUFBSSxhQUFhLEtBQUssU0FBUyxFQUFFO1FBRy9CLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQzFCO0lBQ0QsTUFBTSxRQUFRLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsa0JBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUVsRSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFO1NBQ3pCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxlQUFFLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDL0MsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLG9CQUFvQixFQUFFLGlCQUFPLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDdkYsQ0FBQztBQWhCRCxnQ0FnQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgeyBydW5QYXRjaGVyIH0gZnJvbSAnaGFybW9ueS1wYXRjaGVyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IHsgZnMgfSBmcm9tICd2b3J0ZXgtYXBpJztcblxuaW1wb3J0IHsgREFUQVBBVEgsIEVOVFJZX1BPSU5ULCBHQU1FX0lEIH0gZnJvbSAnLi9zdGF0aWNzJztcbmltcG9ydCB7IGdldERpc2NvdmVyeVBhdGggfSBmcm9tICcuL3V0aWwnO1xuXG4vKlxuZXhwb3J0IGZ1bmN0aW9uIG1pZ3JhdGUwMTAoY29udGV4dCwgb2xkVmVyc2lvbikge1xuICBpZiAoc2VtdmVyLmd0ZShvbGRWZXJzaW9uLCAnMC4xLjAnKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIGNvbnN0IHN0YXRlID0gY29udGV4dC5hcGkuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgY29uc3QgZGlzY292ZXJ5UGF0aCA9IGdldERpc2NvdmVyeVBhdGgoc3RhdGUpO1xuICBpZiAoZGlzY292ZXJ5UGF0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gR2FtZSB3YXMgbm90IGRpc2NvdmVyZWQsIHRoaXMgaXMgYSB2YWxpZCB1c2UgY2FzZS5cbiAgICAvLyAgVXNlciBtaWdodCBub3Qgb3duIHRoZSBnYW1lLlxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIGNvbnN0IGFic1BhdGggPSBwYXRoLmpvaW4oZGlzY292ZXJ5UGF0aCwgREFUQVBBVEgpO1xuICBjb25zdCBhc3NlbWJseVBhdGggPSBwYXRoLmpvaW4oYWJzUGF0aCwgJ1ZvcnRleEhhcm1vbnlJbnN0YWxsZXIuZGxsJyk7XG4gIC8vIFRlc3QgaWYgdGhlIHBhdGNoIGV4aXN0cyBhbmQgcmVtb3ZlIGl0LCBpZiBpdCBpcy5cbiAgcmV0dXJuIGZzLnN0YXRBc3luYyhhc3NlbWJseVBhdGgpXG4gICAgLnRoZW4oKCkgPT4gcnVuUGF0Y2hlcihfX2Rpcm5hbWUsIGFic1BhdGgsIEVOVFJZX1BPSU5ULCB0cnVlLFxuICAgICAgcGF0aC5qb2luKGdldERpc2NvdmVyeVBhdGgoc3RhdGUpLCBEQVRBUEFUSCwgJ1ZvcnRleE1vZHMnKSkpXG4gICAgLmNhdGNoKGVyciA9PiBlcnIuY29kZSA9PT0gJ0VOT0VOVCcgPyBQcm9taXNlLnJlc29sdmUoKSA6IFByb21pc2UucmVqZWN0KGVycikpO1xufVxuKi9cblxuZXhwb3J0IGZ1bmN0aW9uIG1pZ3JhdGUwMjAoY29udGV4dCwgb2xkVmVyc2lvbikge1xuICBpZiAoc2VtdmVyLmd0ZShvbGRWZXJzaW9uLCAnMC4yLjAnKSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuXG4gIGNvbnN0IGRpc2NvdmVyeVBhdGggPSBnZXREaXNjb3ZlcnlQYXRoKGNvbnRleHQuYXBpLmdldFN0YXRlKCkpO1xuICBpZiAoZGlzY292ZXJ5UGF0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gR2FtZSB3YXMgbm90IGRpc2NvdmVyZWQsIHRoaXMgaXMgYSB2YWxpZCB1c2UgY2FzZS5cbiAgICAvLyAgVXNlciBtaWdodCBub3Qgb3duIHRoZSBnYW1lLlxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxuICBjb25zdCBtb2RzUGF0aCA9IHBhdGguam9pbihkaXNjb3ZlcnlQYXRoLCBEQVRBUEFUSCwgJ1ZvcnRleE1vZHMnKTtcblxuICByZXR1cm4gY29udGV4dC5hcGkuYXdhaXRVSSgpXG4gICAgLnRoZW4oKCkgPT4gZnMuZW5zdXJlRGlyV3JpdGFibGVBc3luYyhtb2RzUGF0aCkpXG4gICAgLnRoZW4oKCkgPT4gY29udGV4dC5hcGkuZW1pdEFuZEF3YWl0KCdwdXJnZS1tb2RzLWluLXBhdGgnLCBHQU1FX0lELCAnJywgbW9kc1BhdGgpKTtcbn1cbiJdfQ==