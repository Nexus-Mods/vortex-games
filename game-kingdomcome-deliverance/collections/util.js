"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isValidMod = isValidMod;
exports.isModInCollection = isModInCollection;
exports.genCollectionLoadOrder = genCollectionLoadOrder;
exports.getModId = getModId;
const vortex_api_1 = require("vortex-api");
const util_1 = require("../util");
function isValidMod(mod) {
    return (mod !== undefined)
        && (mod.type !== 'collection');
}
function isModInCollection(collectionMod, mod) {
    if (collectionMod.rules === undefined) {
        return false;
    }
    return collectionMod.rules.find(rule => vortex_api_1.util.testModReference(mod, rule.reference)) !== undefined;
}
function genCollectionLoadOrder(loadOrder, mods, collection) {
    const sortedMods = (loadOrder || []).filter(loId => {
        const modId = getModId(mods, loId);
        return (collection !== undefined)
            ? isValidMod(mods[modId]) && (isModInCollection(collection, mods[modId]))
            : isValidMod(mods[modId]);
    });
    return sortedMods;
}
function getModId(mods, loId) {
    return Object.keys(mods).find(modId => (0, util_1.transformId)(modId) === loId);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSxnQ0FHQztBQUVELDhDQU9DO0FBRUQsd0RBVUM7QUFFRCw0QkFFQztBQWhDRCwyQ0FBeUM7QUFFekMsa0NBQXNDO0FBRXRDLFNBQWdCLFVBQVUsQ0FBQyxHQUFlO0lBQ3hDLE9BQU8sQ0FBQyxHQUFHLEtBQUssU0FBUyxDQUFDO1dBQ3JCLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsQ0FBQztBQUNuQyxDQUFDO0FBRUQsU0FBZ0IsaUJBQWlCLENBQUMsYUFBeUIsRUFBRSxHQUFlO0lBQzFFLElBQUksYUFBYSxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUN0QyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxPQUFPLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ3JDLGlCQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQztBQUM5RCxDQUFDO0FBRUQsU0FBZ0Isc0JBQXNCLENBQUMsU0FBbUIsRUFDbkIsSUFBcUMsRUFDckMsVUFBdUI7SUFDNUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ2pELE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbkMsT0FBTyxDQUFDLFVBQVUsS0FBSyxTQUFTLENBQUM7WUFDL0IsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN6RSxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQUVELFNBQWdCLFFBQVEsQ0FBQyxJQUFxQyxFQUFFLElBQVk7SUFDMUUsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUEsa0JBQVcsRUFBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztBQUN0RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZXMsIHV0aWwgfSBmcm9tICd2b3J0ZXgtYXBpJztcclxuXHJcbmltcG9ydCB7IHRyYW5zZm9ybUlkIH0gZnJvbSAnLi4vdXRpbCc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZE1vZChtb2Q6IHR5cGVzLklNb2QpIHtcclxuICByZXR1cm4gKG1vZCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgJiYgKG1vZC50eXBlICE9PSAnY29sbGVjdGlvbicpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNNb2RJbkNvbGxlY3Rpb24oY29sbGVjdGlvbk1vZDogdHlwZXMuSU1vZCwgbW9kOiB0eXBlcy5JTW9kKSB7XHJcbiAgaWYgKGNvbGxlY3Rpb25Nb2QucnVsZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbGxlY3Rpb25Nb2QucnVsZXMuZmluZChydWxlID0+XHJcbiAgICB1dGlsLnRlc3RNb2RSZWZlcmVuY2UobW9kLCBydWxlLnJlZmVyZW5jZSkpICE9PSB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5Db2xsZWN0aW9uTG9hZE9yZGVyKGxvYWRPcmRlcjogc3RyaW5nW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHM6IHsgW21vZElkOiBzdHJpbmddOiB0eXBlcy5JTW9kIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24/OiB0eXBlcy5JTW9kKTogc3RyaW5nW10ge1xyXG4gIGNvbnN0IHNvcnRlZE1vZHMgPSAobG9hZE9yZGVyIHx8IFtdKS5maWx0ZXIobG9JZCA9PiB7XHJcbiAgICBjb25zdCBtb2RJZCA9IGdldE1vZElkKG1vZHMsIGxvSWQpO1xyXG4gICAgcmV0dXJuIChjb2xsZWN0aW9uICE9PSB1bmRlZmluZWQpXHJcbiAgICAgID8gaXNWYWxpZE1vZChtb2RzW21vZElkXSkgJiYgKGlzTW9kSW5Db2xsZWN0aW9uKGNvbGxlY3Rpb24sIG1vZHNbbW9kSWRdKSlcclxuICAgICAgOiBpc1ZhbGlkTW9kKG1vZHNbbW9kSWRdKTtcclxuICB9KTtcclxuICByZXR1cm4gc29ydGVkTW9kcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vZElkKG1vZHM6IHsgW21vZElkOiBzdHJpbmddOiB0eXBlcy5JTW9kIH0sIGxvSWQ6IHN0cmluZykge1xyXG4gIHJldHVybiBPYmplY3Qua2V5cyhtb2RzKS5maW5kKG1vZElkID0+IHRyYW5zZm9ybUlkKG1vZElkKSA9PT0gbG9JZCk7XHJcbn1cclxuIl19