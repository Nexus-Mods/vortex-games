"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getModId = exports.genCollectionLoadOrder = exports.isModInCollection = exports.isValidMod = void 0;
const vortex_api_1 = require("vortex-api");
const util_1 = require("../util");
function isValidMod(mod) {
    return (mod !== undefined)
        && (mod.type !== 'collection');
}
exports.isValidMod = isValidMod;
function isModInCollection(collectionMod, mod) {
    if (collectionMod.rules === undefined) {
        return false;
    }
    return collectionMod.rules.find(rule => vortex_api_1.util.testModReference(mod, rule.reference)) !== undefined;
}
exports.isModInCollection = isModInCollection;
function genCollectionLoadOrder(loadOrder, mods, collection) {
    const sortedMods = (loadOrder || []).filter(loId => {
        const modId = getModId(mods, loId);
        return (collection !== undefined)
            ? isValidMod(mods[modId]) && (isModInCollection(collection, mods[modId]))
            : isValidMod(mods[modId]);
    });
    return sortedMods;
}
exports.genCollectionLoadOrder = genCollectionLoadOrder;
function getModId(mods, loId) {
    return Object.keys(mods).find(modId => (0, util_1.transformId)(modId) === loId);
}
exports.getModId = getModId;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQXlDO0FBRXpDLGtDQUFzQztBQUV0QyxTQUFnQixVQUFVLENBQUMsR0FBZTtJQUN4QyxPQUFPLENBQUMsR0FBRyxLQUFLLFNBQVMsQ0FBQztXQUNyQixDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssWUFBWSxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUhELGdDQUdDO0FBRUQsU0FBZ0IsaUJBQWlCLENBQUMsYUFBeUIsRUFBRSxHQUFlO0lBQzFFLElBQUksYUFBYSxDQUFDLEtBQUssS0FBSyxTQUFTLEVBQUU7UUFDckMsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUVELE9BQU8sYUFBYSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDckMsaUJBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDO0FBQzlELENBQUM7QUFQRCw4Q0FPQztBQUVELFNBQWdCLHNCQUFzQixDQUFDLFNBQW1CLEVBQ25CLElBQXFDLEVBQ3JDLFVBQXVCO0lBQzVELE1BQU0sVUFBVSxHQUFHLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNqRCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ25DLE9BQU8sQ0FBQyxVQUFVLEtBQUssU0FBUyxDQUFDO1lBQy9CLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDekUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztJQUNILE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUM7QUFWRCx3REFVQztBQUVELFNBQWdCLFFBQVEsQ0FBQyxJQUFxQyxFQUFFLElBQVk7SUFDMUUsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUEsa0JBQVcsRUFBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztBQUN0RSxDQUFDO0FBRkQsNEJBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0eXBlcywgdXRpbCB9IGZyb20gJ3ZvcnRleC1hcGknO1xuXG5pbXBvcnQgeyB0cmFuc2Zvcm1JZCB9IGZyb20gJy4uL3V0aWwnO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZE1vZChtb2Q6IHR5cGVzLklNb2QpIHtcbiAgcmV0dXJuIChtb2QgIT09IHVuZGVmaW5lZClcbiAgICAmJiAobW9kLnR5cGUgIT09ICdjb2xsZWN0aW9uJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc01vZEluQ29sbGVjdGlvbihjb2xsZWN0aW9uTW9kOiB0eXBlcy5JTW9kLCBtb2Q6IHR5cGVzLklNb2QpIHtcbiAgaWYgKGNvbGxlY3Rpb25Nb2QucnVsZXMgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiBjb2xsZWN0aW9uTW9kLnJ1bGVzLmZpbmQocnVsZSA9PlxuICAgIHV0aWwudGVzdE1vZFJlZmVyZW5jZShtb2QsIHJ1bGUucmVmZXJlbmNlKSkgIT09IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbkNvbGxlY3Rpb25Mb2FkT3JkZXIobG9hZE9yZGVyOiBzdHJpbmdbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHM6IHsgW21vZElkOiBzdHJpbmddOiB0eXBlcy5JTW9kIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uPzogdHlwZXMuSU1vZCk6IHN0cmluZ1tdIHtcbiAgY29uc3Qgc29ydGVkTW9kcyA9IChsb2FkT3JkZXIgfHwgW10pLmZpbHRlcihsb0lkID0+IHtcbiAgICBjb25zdCBtb2RJZCA9IGdldE1vZElkKG1vZHMsIGxvSWQpO1xuICAgIHJldHVybiAoY29sbGVjdGlvbiAhPT0gdW5kZWZpbmVkKVxuICAgICAgPyBpc1ZhbGlkTW9kKG1vZHNbbW9kSWRdKSAmJiAoaXNNb2RJbkNvbGxlY3Rpb24oY29sbGVjdGlvbiwgbW9kc1ttb2RJZF0pKVxuICAgICAgOiBpc1ZhbGlkTW9kKG1vZHNbbW9kSWRdKTtcbiAgfSk7XG4gIHJldHVybiBzb3J0ZWRNb2RzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9kSWQobW9kczogeyBbbW9kSWQ6IHN0cmluZ106IHR5cGVzLklNb2QgfSwgbG9JZDogc3RyaW5nKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhtb2RzKS5maW5kKG1vZElkID0+IHRyYW5zZm9ybUlkKG1vZElkKSA9PT0gbG9JZCk7XG59XG4iXX0=